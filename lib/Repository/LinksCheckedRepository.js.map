{"version":3,"sources":["../../src/Repository/LinksCheckedRepository.js"],"names":["LinksCheckedRepository","constructor","args","folder","createBrokenLinksFolder","db","Database","databaseFile","insertStatement","prepare","find","link","get","url","save","linkChecked","run","working","close","output","filename","getSiteName","tempDbFile","__filename"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;;;AAEe,MAAMA,sBAAN,CAA6B;AACxC;;;;AAIAC,EAAAA,WAAW,CAACC,IAAD,EAAO;AACd;;;;AAIA,SAAKA,IAAL,GAAYA,IAAZ;AACA;;;;;AAIA,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,uBAAL;AAEA,SAAKC,EAAL,GAAU,IAAIC,qBAAJ,CAAa,KAAKC,YAAlB,EAAgC,EAAhC,CAAV;AACA,SAAKC,eAAL,GAAuB,KAAKH,EAAL,CAAQI,OAAR,CAAgB,yCAAhB,CAAvB;AACH;AAED;;;;;;;AAKAC,EAAAA,IAAI,CAACC,IAAD,EAAO;AACP,WAAO,KAAKN,EAAL,CAAQI,OAAR,CAAgB,yCAAhB,EAA2DG,GAA3D,CAA+DD,IAAI,CAACE,GAApE,CAAP;AACH;AAED;;;;;;AAIAC,EAAAA,IAAI,CAACC,WAAD,EAAc;AACd,SAAKP,eAAL,CAAqBQ,GAArB,CAAyB,CAACD,WAAW,CAACF,GAAb,EAAkBE,WAAW,CAACE,OAAZ,GAAsB,CAAtB,GAA0B,CAA5C,CAAzB;AACH;AAED;;;;;AAGAC,EAAAA,KAAK,GAAG;AACJ,SAAKb,EAAL,CAAQa,KAAR;AACH;AAED;;;;;AAGAd,EAAAA,uBAAuB,GAAG;AACtB,SAAKD,MAAL,GAAc,gBAAK,KAAKD,IAAL,CAAUiB,MAAV,CAAiBC,QAAtB,EAAgC,KAAKlB,IAAL,CAAUmB,WAAV,EAAhC,EAAyD,cAAzD,CAAd;;AACA,QAAI,CAAC,oBAAW,KAAKlB,MAAhB,CAAL,EAA8B;AAC1B,yBAAU,KAAKA,MAAf;AACH;;AACD,SAAKI,YAAL,GAAoB,gBAAK,KAAKJ,MAAV,EAAkB,sBAAlB,CAApB;;AAGA,QAAI,CAAC,oBAAW,KAAKI,YAAhB,CAAL,EAAoC;AAChC,UAAIe,UAAU,GAAG,gBAAK,mBAAQC,UAAR,CAAL,EAA0B,+BAA1B,CAAjB;AAEA,4BAAaD,UAAb,EAAyB,KAAKf,YAA9B;AACH;AACJ;;AA9DuC","sourcesContent":["import Database from 'better-sqlite3';\nimport { existsSync, mkdirSync, copyFileSync } from 'fs';\nimport Args from '../Model/Args';\nimport LinkChecked from '../Model/LinkChecked';\nimport { join, dirname } from \"path\";\n\nexport default class LinksCheckedRepository {\n    /**\n     * Create a broken links repo.\n     * @param args {Args} from the commandline.\n     */\n    constructor(args) {\n        /**\n         * From the commandline.\n         * @type {Args}\n         */\n        this.args = args;\n        /**\n         * Folder to save the broken links to.\n         * @type {string} full path to the broken links folder in the project.\n         */\n        this.folder = '';\n        this.createBrokenLinksFolder();\n\n        this.db = new Database(this.databaseFile, {});\n        this.insertStatement = this.db.prepare('INSERT INTO links_checked VALUES (?, ?)');\n    }\n\n    /**\n     * Find a checked link give a link.\n     * @param link {Link}\n     * @return {LinkChecked}\n     */\n    find(link) {\n        return this.db.prepare('SELECT * FROM links_checked WHERE url=?').get(link.url);\n    }\n\n    /**\n     * Save the checked link.\n     * @param linkChecked {LinkChecked}\n     */\n    save(linkChecked) {\n        this.insertStatement.run([linkChecked.url, linkChecked.working ? 1 : 0]);\n    }\n\n    /**\n     * Close the database when done.\n     */\n    close() {\n        this.db.close();\n    }\n\n    /**\n     * Creates a broken links folder in the project folder.\n     */\n    createBrokenLinksFolder() {\n        this.folder = join(this.args.output.filename, this.args.getSiteName(), 'broken_links');\n        if (!existsSync(this.folder)) {\n            mkdirSync(this.folder)\n        }\n        this.databaseFile = join(this.folder, 'links_checked.sqlite');\n\n\n        if (!existsSync(this.databaseFile)) {\n            let tempDbFile = join(dirname(__filename), '../Asset/links_checked.sqlite');\n\n            copyFileSync(tempDbFile, this.databaseFile)\n        }\n    }\n\n}"],"file":"LinksCheckedRepository.js"}