#!/usr/bin/env node

const commandLineArgs = require('command-line-args');
const getUsage = require('command-line-usage');

const menu = require('./src/Model/Menu');
const Args = require('./src/Model/Args');

const ProgressUtility = require('./src/Utility/ProgressUtility');
const BrokenLinksService = require('./src/Service/BrokenLinksService');

let args = new Args(commandLineArgs(menu[1]['optionList']));

if (args.shouldShowHelp()) {
    console.log(getUsage(menu));
} else {
    args.output.doesFolderExist();
    let brokenLinksService = new BrokenLinksService(args);
    let bar;
    console.log('\nStarting Broken Links');
    brokenLinksService.on('start', urls => {
        if (args.verbose) {
            bar = ProgressUtility.build(urls.length);
        }
    }).on('progress', url => {
        if (args.verbose) {
            bar.tick(1, {message: 'checking: ' + url.url});
        }
    }).on('complete', () => console.log('Done'));
    brokenLinksService.start();
}